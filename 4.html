<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Napi Jelentés</title>
<style>
body{font-family:'Segoe UI',sans-serif;background:#0f172a;color:white;margin:0;padding:10px;padding-bottom:100px;}
.top-bar{background:#1e293b;padding:15px;border-radius:12px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3b82f6;}
.stat-box{text-align:center;}
.stat-val{font-size:1.8rem;font-weight:bold;display:block;font-family:monospace;}
.green{color:#10b981;} .red{color:#ef4444;}
.input-row{display:grid;grid-template-columns:1fr 1fr 1fr 40px;gap:8px;margin-bottom:10px;background:#1e293b;padding:10px;border-radius:10px;}
input{width:100%;padding:10px;background:#0f172a;border:1px solid #334155;color:white;border-radius:6px;text-align:center;box-sizing:border-box;font-size:1rem;}
button.del{background:rgba(239,68,68,0.2);color:#ef4444;border:1px solid #ef4444;border-radius:6px;font-weight:bold;}
button.add{width:100%;padding:15px;background:#3b82f6;color:white;border:none;border-radius:10px;font-size:1.1rem;font-weight:bold;margin-top:10px;}
.eff-wrapper{display:flex;align-items:center;gap:5px;font-size:0.9rem;}
#effInput{width:50px;padding:5px;border:none;border-bottom:2px solid #10b981;background:transparent;color:#10b981;font-weight:bold;}
</style>
</head>
<body>

<div class="top-bar">
<div class="stat-box">
<span class="stat-val green" id="totalTime">00:00</span>
<small style="color:#94a3b8">ÖSSZES</small>
</div>
<div class="eff-wrapper">
Hatékonyság: <input type="number" id="effInput" value="87" oninput="reCalc()"> %
</div>
<div class="stat-box">
<span class="stat-val red" id="missingTime">12:00</span>
<small style="color:#94a3b8">HIÁNYZÓ</small>
</div>
</div>

<div id="list"></div>

<button class="add" onclick="addRow()">+ ÚJ SOR HOZZÁADÁSA</button>

<script>
// Ez a függvény induláskor fut le
window.onload = function() {
// Megpróbáljuk betölteni a mentést, de ha nem megy, nem fagyunk le!
try {
const saved = localStorage.getItem('forvia_data');
const eff = localStorage.getItem('forvia_eff');
if(eff) document.getElementById('effInput').value = eff;

if(saved) {
JSON.parse(saved).forEach(item => addRow(item));
} else {
addRow(); // Ha nincs mentés, egy üres sor
}
} catch(e) {
console.log("Mentés nem elérhető (Offline mód) - Folytatás...");
addRow();
}
reCalc();
};

function addRow(data = {t:'', q:'', d:''}) {
const div = document.createElement('div');
div.className = 'input-row';
div.innerHTML = `
<input type="number" class="t" placeholder="mp" value="${data.t}" oninput="reCalc()">
<input type="number" class="q" placeholder="db" value="${data.q}" oninput="reCalc()">
<input type="number" class="d" placeholder="Állás" value="${data.d}" oninput="reCalc()">
<button class="del" onclick="this.parentElement.remove(); reCalc()">X</button>
`;
document.getElementById('list').appendChild(div);
}

function reCalc() {
let totalSeconds = 0;
const eff = (parseFloat(document.getElementById('effInput').value) || 1) / 100;

const rows = document.querySelectorAll('.input-row');
const dataToSave = [];

rows.forEach(r => {
const t = parseFloat(r.querySelector('.t').value) || 0;
const q = parseFloat(r.querySelector('.q').value) || 0;
const d = parseFloat(r.querySelector('.d').value) || 0;

// Számítás: (Takt * Db) / Hatékonyság + Állásidő
totalSeconds += ((t * q) / eff) + (d * 60);

// Adatok gyűjtése mentéshez
dataToSave.push({t: r.querySelector('.t').value, q: r.querySelector('.q').value, d: r.querySelector('.d').value});
});

// Eredmények kiírása
const h = Math.floor(totalSeconds / 3600);
const m = Math.floor((totalSeconds % 3600) / 60);
document.getElementById('totalTime').innerText = `${h}:${m.toString().padStart(2, '0')}`;

const shiftSeconds = 12 * 3600;
const missSeconds = Math.max(0, shiftSeconds - totalSeconds);
const mh = Math.floor(missSeconds / 3600);
const mm = Math.floor((missSeconds % 3600) / 60);
document.getElementById('missingTime').innerText = `${mh}:${mm.toString().padStart(2, '0')}`;

// Mentés megkísérlése (HIBA NÉLKÜL)
try {
localStorage.setItem('forvia_data', JSON.stringify(dataToSave));
localStorage.setItem('forvia_eff', document.getElementById('effInput').value);
} catch(e) {
// Ha nem sikerül menteni, csendben maradunk, nem fagyasztjuk le a programot
}
}
</script>
</body>
</html>
