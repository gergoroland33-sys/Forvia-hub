<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Super Generáló Pro - GERGŐ ROLAND</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root { --bg: #0b0f1a; --card: #161e2e; --accent: #2563eb; --success: #059669; --error: #dc2626; --text: #f3f4f6; --border: #374151; }
body { font-family: 'Inter', 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 5px; font-size: 11px; height: 100vh; overflow: hidden; display: flex; justify-content: center; }
.app-container { width: 100%; max-width: 1100px; background: var(--card); border: 1px solid var(--border); border-radius: 6px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

/* Header */
.top-bar { display: flex; align-items: center; justify-content: space-between; padding: 8px 15px; border-bottom: 1px solid var(--border); background: #111827; }
.brand { font-weight: 800; letter-spacing: 1px; color: var(--accent); font-size: 13px; }
.nav-tools { display: flex; gap: 8px; align-items: center; }

/* Mód és Fájl egy sorban */
.action-bar { display: grid; grid-template-columns: 180px 1fr 200px; gap: 10px; padding: 10px; background: #1c2535; border-bottom: 1px solid var(--border); }
.mode-group { display: flex; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; }
.mode-btn { flex: 1; padding: 6px; border: none; background: #0f172a; color: #9ca3af; cursor: pointer; font-size: 10px; font-weight: bold; transition: 0.2s; }
.mode-btn.active { background: var(--accent); color: white; }
.file-zone { border: 1px dashed var(--accent); border-radius: 4px; display: flex; align-items: center; justify-content: center; background: rgba(37, 99, 235, 0.05); cursor: pointer; font-weight: 500; }
.info-pill { background: #0b0f1a; border: 1px solid var(--border); border-radius: 4px; padding: 0 10px; display: flex; align-items: center; gap: 10px; }

/* Munkaterület */
.work-area { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--border); flex-grow: 1; }
.panel { background: var(--card); display: flex; flex-direction: column; }
.panel-header { padding: 4px 10px; background: #111827; font-size: 9px; text-transform: uppercase; color: #6b7280; font-weight: bold; }
textarea { flex-grow: 1; background: var(--bg); border: none; color: #fff; padding: 10px; resize: none; font-family: 'Consolas', monospace; font-size: 13px; outline: none; }
.list-container { flex-grow: 1; background: var(--bg); overflow-y: auto; padding: 5px; }
.row { display: flex; justify-content: space-between; padding: 4px 8px; margin-bottom: 2px; border-radius: 2px; font-family: monospace; }
.row.ok { border-left: 3px solid var(--success); background: rgba(5, 150, 105, 0.1); }
.row.err { border-left: 3px solid var(--error); background: rgba(220, 38, 38, 0.1); }

/* Alsó vezérlő sáv */
.bottom-bar { display: flex; align-items: center; justify-content: space-between; padding: 8px 15px; background: #111827; border-top: 1px solid var(--border); }
.fix-input-group { display: flex; align-items: center; gap: 8px; }
.fix-input { background: var(--bg); border: 1px solid var(--border); color: white; width: 40px; text-align: center; padding: 4px; border-radius: 3px; font-weight: bold; }
.gen-btn { background: var(--success); color: white; border: none; padding: 8px 30px; border-radius: 4px; font-weight: bold; cursor: pointer; font-size: 12px; transition: 0.3s; }
.gen-btn:disabled { background: #374151; cursor: not-allowed; opacity: 0.5; }
.gen-btn:hover:not(:disabled) { background: #047857; }

/* Súgó Modal */
.modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(4px); }
.modal-content { background: var(--card); margin: 5vh auto; padding: 25px; border-radius: 12px; width: 85%; max-width: 600px; border: 1px solid var(--accent); line-height: 1.5; font-size: 13px; }
.modal-content h2 { color: var(--accent); margin-top: 0; }
.step { margin-bottom: 15px; border-left: 2px solid var(--accent); padding-left: 15px; }
.step b { color: var(--accent); display: block; margin-bottom: 3px; }
.close-help { width: 100%; padding: 10px; background: var(--accent); border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 20px; }

.creator { font-size: 9px; color: #4b5563; font-weight: bold; letter-spacing: 1px; }
</style>
</head>
<body>

<div id="helpModal" class="modal">
<div class="modal-content">
<h2>Hogyan használd a rendszert?</h2>

<div class="step">
<b>1. MÓD KIVÁLASZTÁSA:</b>
SPI: Új CSV-ket gyárt, ahol a fájlnév maga a vonalkód.<br>
CKD: A fájlnév elejét cseréli le, a többi részét megtartja.
</div>

<div class="step">
<b>2. SABLON BETÖLTÉSE:</b>
Húzd be a "JÓ" CSV fájlt a kék zónába. A program ebből tanulja meg az eredeti kódot és a hosszt.
</div>

<div class="step">
<b>3. ADATBEVITEL (SCANNER):</b>
Kattints a bal oldali sötét mezőbe és kezdd el csipogni a hiányzó kódokat. A scanner automatikusan új sorba teszi őket.
</div>

<div class="step">
<b>4. ELLENŐRZÉS:</b>
Figyeld a jobb oldalt! <span style="color:var(--success)">Zöld = OK</span>. <span style="color:var(--error)">Piros = Hibás hossz</span>. Csak akkor tudsz menteni, ha nincs a listában piros hiba.
</div>

<div class="step">
<b>5. MENTÉS:</b>
Kattints a zöld gombra. Egy .ZIP fájlt kapsz, amit csak ki kell csomagolnod a célmappába.
</div>

<button class="close-help" onclick="document.getElementById('helpModal').style.display='none'">MINDENT ÉRTEK, KEZDHETJÜK</button>
</div>
</div>

<div class="app-container">
<div class="top-bar">
<div class="brand">Kohyoung/CKD Szuper Generáló PRO</div>
<div class="nav-tools">
<button class="help-btn" onclick="document.getElementById('helpModal').style.display='block'" style="background:transparent; border:1px solid #4b5563; color:#9ca3af; padding:2px 10px; border-radius:4px; cursor:pointer; font-size:10px;">SEGÍTSÉG / ÚTMUTATÓ</button>
</div>
</div>

<div class="action-bar">
<div class="mode-group">
<button class="mode-btn active" id="btnSPI" onclick="setMode('SPI')">SPI MÓD</button>
<button class="mode-btn" id="btnCKD" onclick="setMode('CKD')">CKD MÓD</button>
</div>
<div class="file-zone" id="dropZone" onclick="document.getElementById('fileInp').click()">
<span id="fileNameDisp">SABLON CSV BEHÚZÁSA</span>
<input type="file" id="fileInp" hidden accept=".csv" onchange="handleFile(this.files[0])">
</div>
<div class="info-pill">
<span>KÓD: <b id="origBarcode" style="color:var(--accent)">-</b></span>
<span>HOSSZ: <b id="origLength" style="color:var(--accent)">-</b></span>
</div>
</div>

<div class="work-area">
<div class="panel">
<div class="panel-header">Bemeneti adatok (Scanner)</div>
<textarea id="barcodeInp" placeholder="Csipogd be a kódokat..." oninput="processInput()"></textarea>
</div>
<div class="panel">
<div class="panel-header">Ellenőrzési lista</div>
<div id="previewList" class="list-container"></div>
</div>
</div>

<div class="bottom-bar">
<div class="fix-input-group" id="spiTools">
<span style="color:#9ca3af; font-size:10px;">UTOLSÓ KARAKTER FIXÁLÁSA:</span>
<input type="text" id="fixChar" class="fix-input" maxlength="1" placeholder="-" oninput="processInput()">
</div>

<button class="gen-btn" id="genBtn" disabled onclick="generateZip()">GENERÁLÁS (.ZIP)</button>

<div class="creator">GERGŐ ROLAND</div>
</div>
</div>

<script>
let currentMode = 'SPI', csvContent = "", originalBarcode = "", originalFileName = "", processedBarcodes = [];
function setMode(mode) { currentMode = mode; document.getElementById('btnSPI').classList.toggle('active', mode === 'SPI'); document.getElementById('btnCKD').classList.toggle('active', mode === 'CKD'); if(originalFileName) handleFileProcessing(originalFileName); }
function handleFile(file) { if(!file) return; originalFileName = file.name; const reader = new FileReader(); reader.onload = (e) => { csvContent = e.target.result; handleFileProcessing(file.name); }; reader.readAsText(file); }
function handleFileProcessing(name) { document.getElementById('fileNameDisp').innerText = name.toUpperCase(); originalBarcode = (currentMode === 'CKD') ? name.split('_')[0] : name.replace('.csv', '').split('_')[0]; document.getElementById('origBarcode').innerText = originalBarcode; document.getElementById('origLength').innerText = originalBarcode.length; processInput(); }
function processInput() {
const raw = document.getElementById('barcodeInp').value; const fix = document.getElementById('fixChar').value;
const lines = raw.split(/[\n, ]+/).map(s => s.trim()).filter(s => s !== "");
const listDiv = document.getElementById('previewList'); listDiv.innerHTML = ""; processedBarcodes = []; let err = false;
lines.forEach(code => {
let final = (currentMode === 'SPI' && fix !== "") ? code.substring(0, code.length - 1) + fix : code;
const ok = final.length === originalBarcode.length; if (!ok) err = true;
const item = document.createElement('div'); item.className = `row ${ok ? 'ok' : 'err'}`;
item.innerHTML = `<span>${final}</span> <b>${ok ? 'OK' : 'HIBA'}</b>`;
listDiv.appendChild(item); if (ok) processedBarcodes.push(final);
});
document.getElementById('genBtn').disabled = (processedBarcodes.length === 0 || err || !csvContent);
}
async function generateZip() {
const zip = new JSZip();
const btn = document.getElementById('genBtn'); btn.innerText = "CSOMAGOLÁS..."; btn.disabled = true;
processedBarcodes.forEach(c => {
const content = csvContent.split(originalBarcode).join(c);
const name = (currentMode === 'CKD') ? originalFileName.replace(originalBarcode, c) : (c + ".csv");
zip.file(name, content);
});
const blob = await zip.generateAsync({type:"blob"});
const link = document.createElement("a");
link.href = URL.createObjectURL(blob);
link.download = `Generalt_${currentMode}_${new Date().getTime()}.zip`;
link.click();
btn.innerText = "GENERÁLÁS (.ZIP)"; btn.disabled = false;
}
</script>
</body>
</html>
