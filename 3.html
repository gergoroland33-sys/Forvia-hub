<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forvia SMT | M≈±szaknapt√°r Pro</title>
<style>
:root{
    --primary:#3b82f6;
    --bg:#0f172a;
    --card-bg:#1e293b;
    --card-border:#334155;
    --text-main:#f1f5f9;
    --text-muted:#94a3b8;
    --accent:#fbbf24;
    --color-A:#60a5fa; --color-B:#4ade80; --color-C:#fbbf24; --color-D:#f87171;
}

body{
    font-family:'Inter',-apple-system,sans-serif;
    background-color:var(--bg);
    background-image:radial-gradient(circle at top right,#1e293b,#0f172a);
    margin:0; padding:15px; color:var(--text-main); min-height:100vh;
}
.container{max-width:550px;margin:0 auto;}

header{text-align:center;margin-bottom:10px;padding-top:5px; transition: opacity 0.3s;}
header h1{font-size:1.6rem;font-weight:800;margin:0;background:linear-gradient(to right,#60a5fa,#3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
header p { margin: 5px 0 0 0; color: var(--text-muted); font-size: 0.8rem; }

/* --- DINAMIKUS FILTER PANEL --- */
.filter-panel{
    position: sticky;
    top: 10px; 
    z-index: 100;
    
    /* ALAP√ÅLLAPOT (√âles, teli sz√≠n) */
    background: #1e293b; /* Teli s√∂t√©tk√©k */
    backdrop-filter: none; /* Nincs hom√°ly */
    border: 1px solid var(--card-border);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    
    padding:15px; 
    border-radius:16px; 
    margin-bottom:25px; 
    display:grid; grid-template-columns:1fr 1fr; gap:10px;
    
    /* A var√°zslat: finom √°tmenet minden tulajdons√°gra */
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* G√ñRGETETT √ÅLLAPOT (Ez a "scrolled" class kapcsol be JS-el) */
.filter-panel.scrolled {
    background: rgba(15, 23, 42, 0.65); /* √Åttetsz≈ë */
    backdrop-filter: blur(16px) saturate(180%); /* Er≈ës hom√°ly + sz√≠nkiemel√©s */
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border-color: rgba(255, 255, 255, 0.15); /* Finomabb keret */
    box-shadow: 0 20px 40px rgba(0,0,0,0.6); /* M√©lyebb √°rny√©k */
    transform: translateY(-5px); /* Picit feljebb ugrik */
}

label{display:block;font-size:0.65rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-muted);margin-bottom:4px;}
select{width:100%;padding:10px;background:#0b1120;border:1px solid var(--card-border);border-radius:10px;color:white;font-size:14px;outline:none;}

/* GOMBOK */
.btn-group { grid-column: span 2; display: flex; gap: 10px; margin-top: 5px; }
.gomb{
    flex: 1; padding:12px;
    background:rgba(59,130,246,0.15);
    color:var(--primary);
    border:1px solid rgba(59, 130, 246, 0.5);
    border-radius:10px;
    font-weight:700; font-size: 0.9rem;
    cursor:pointer; transition:0.2s;
}
.gomb:hover{background:var(--primary);color:white; box-shadow: 0 0 15px rgba(59,130,246,0.5);}
.gomb:active { transform: scale(0.98); }
.icon-btn { flex: 0 0 45px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

/* --- DAY CARD (MARADT A R√âGI) --- */
.day-card {
    background: #1e293b;
    border-radius: 20px;
    padding: 2px;
    margin-bottom: 25px;
    position: relative;
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    overflow: hidden;
    background: linear-gradient(145deg, #334155, #0f172a);
    scroll-margin-top: 200px; /* Helyet hagyunk a headernek ugr√°skor */
}

@keyframes border-rotate {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.day-card.today-active {
    background: linear-gradient(90deg, #3b82f6, #fbbf24, #3b82f6, #10b981, #3b82f6);
    background-size: 300% 300%;
    animation: border-rotate 4s linear infinite;
    box-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
}
.today-label {
    position: absolute; top: 0; right: 0;
    background: var(--primary); color: white;
    font-size: 0.65rem; font-weight: 800;
    padding: 5px 15px; border-bottom-left-radius: 15px;
    z-index: 5; letter-spacing: 1px;
}
.day-card-content {
    background: #1e293b; 
    border-radius: 18px; 
    padding: 20px;
    height: 100%;
}
.date-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 15px; padding-bottom: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}
.date-text { font-size: 1.1rem; font-weight: 800; color: white; }
.day-name { font-size: 0.8rem; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
.weekend .day-name { color: var(--accent); }

/* --- M≈∞SZAK SOROK --- */
.shift-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px; border-radius: 12px; margin-bottom: 8px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255,255,255,0.1);
    position: relative; overflow: hidden; z-index: 0;
}
.shift-row:last-child { margin-bottom: 0; }

.row-muszak-A { --shift-color: var(--color-A); }
.row-muszak-B { --shift-color: var(--color-B); }
.row-muszak-C { --shift-color: var(--color-C); }
.row-muszak-D { --shift-color: var(--color-D); }

.shift-row.active-shift {
    background: linear-gradient(90deg, rgba(255,255,255,0.07), rgba(255,255,255,0));
    border-left: 4px solid var(--shift-color);
    border-color: transparent; 
}
.shift-row.active-shift::before {
    content: ''; position: absolute; z-index: -2;
    left: -50%; top: -50%; width: 200%; height: 200%;
    background: conic-gradient(transparent, transparent, transparent, var(--shift-color) 30%, transparent 50%);
    animation: rotateSnake 3s linear infinite;
}
.shift-row.active-shift::after {
    content: ''; position: absolute; z-index: -1;
    left: 2px; top: 2px; right: 2px; bottom: 2px;
    border-radius: 10px; background: #1e293b; 
}
@keyframes rotateSnake { 100% { transform: rotate(360deg); } }

.shift-details { display: flex; flex-direction: column; z-index: 1; }
.loc { font-weight: 700; font-size: 1rem; color: white; }
.leader { font-size: 0.75rem; color: rgba(255,255,255,0.7); }
.badge { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; background: rgba(0,0,0,0.3); z-index: 1; }
.row-muszak-A .badge { color: var(--color-A); }
.row-muszak-B .badge { color: var(--color-B); }
.row-muszak-C .badge { color: var(--color-C); }
.row-muszak-D .badge { color: var(--color-D); }

/* NAPT√ÅR MODAL */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; }
.modal-content { background: #1e293b; width: 95%; max-width: 400px; border-radius: 20px; padding: 20px; border: 1px solid var(--card-border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes popIn { from{transform: scale(0.8); opacity: 0;} to{transform: scale(1); opacity: 1;} }
.cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.cal-title { font-weight: 800; font-size: 1.2rem; text-transform: uppercase; color: white; }
.cal-nav { background: none; border: none; color: var(--primary); font-size: 1.5rem; cursor: pointer; padding: 0 10px; }
.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
.cal-day-name { text-align: center; font-size: 0.7rem; color: var(--text-muted); font-weight: bold; padding-bottom: 5px; }
.cal-cell { aspect-ratio: 1/1; background: #0f172a; border-radius: 8px; border: 1px solid #334155; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; cursor: pointer; transition: 0.2s;}
.cal-cell:hover { border-color: var(--primary); background: #1e293b; }
.cal-num { font-size: 0.9rem; font-weight: 600; color: #cbd5e1; }
.cal-shift { font-size: 0.7rem; font-weight: 800; position: absolute; bottom: 3px; right: 4px; color: var(--text-muted); display: flex; gap: 2px; }
.code-A { color: var(--color-A); } .code-B { color: var(--color-B); } .code-C { color: var(--color-C); } .code-D { color: var(--color-D); }
.cal-today { border: 2px solid var(--primary); background: rgba(59,130,246,0.1); }
.cal-empty { background: transparent; border: none; cursor: default; }
#eredmeny { padding-bottom: 50px; }
@media (max-width:480px){.filter-panel{grid-template-columns:1fr;}.btn-group{grid-column: span 1;}}
</style>
</head>
<body>
<div class="container">
<header id="mainHeader">
    <h1>FORVIA SMT</h1>
    <p>Digit√°lis M≈±szaknapt√°r 2026</p>
</header>

<div class="filter-panel">
    <div>
        <label>H√≥nap</label>
        <select id="honap">
            <option value="mind">√ñsszes h√≥nap</option>
            <option value="01">Janu√°r</option>
            <option value="02">Febru√°r</option>
            <option value="03">M√°rcius</option>
            <option value="04">√Åprilis</option>
            <option value="05">M√°jus</option>
            <option value="06">J√∫nius</option>
            <option value="07">J√∫lius</option>
            <option value="08">Augusztus</option>
            <option value="09">Szeptember</option>
            <option value="10">Okt√≥ber</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>
    </div>
    <div>
        <label>M≈±szak</label>
        <select id="muszak">
            <option value="mind">Mind</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
        </select>
    </div>
    <div class="btn-group">
        <button class="gomb icon-btn" id="calendarBtn" title="Havi n√©zet">üìÖ</button>
        <button class="gomb" id="maigomb">Ugr√°s a mai naphoz</button>
    </div>
</div>

<div id="eredmeny"></div>
</div>

<div class="modal-overlay" id="calModal" onclick="closeCalendar(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="cal-header">
            <button class="cal-nav" onclick="changeCalMonth(-1)">&#8249;</button>
            <div class="cal-title" id="calTitle">2026 JANU√ÅR</div>
            <button class="cal-nav" onclick="changeCalMonth(1)">&#8250;</button>
        </div>
        <div class="cal-grid" id="calGrid"></div>
        <div style="text-align:center; margin-top:15px;">
            <button class="gomb" style="padding:10px 20px; font-size:0.8rem;" onclick="closeCalendar(null)">Bez√°r√°s</button>
        </div>
    </div>
</div>

<script>
// --- JS G√ñRGET√âS √âRZ√âKEL≈ê ---
window.addEventListener('scroll', () => {
    const panel = document.querySelector('.filter-panel');
    const header = document.getElementById('mainHeader');
    
    if (window.scrollY > 20) {
        // Ha g√∂rget√ºnk: √úveg effekt BE
        panel.classList.add('scrolled');
        header.style.opacity = '0.5'; // A c√≠m elhalv√°nyul
    } else {
        // Ha fent vagyunk: √úveg effekt KI (Teli sz√≠n)
        panel.classList.remove('scrolled');
        header.style.opacity = '1'; // A c√≠m teljesen l√°tszik
    }
});

let muszakok=[];
const vezetok={'A':'Czerovszki Zsolt','B':'Hajdu Zolt√°n','C':'Kamasz √Åd√°m','D':'Komj√°ti Istv√°n'};
function parseDatum(str){if(!str)return null;const isoStr=str.replace(/\./g,'-').replace(/\s/g,'').replace(/-$/,'');return new Date(isoStr);}
function getNapNeve(ds){const d=parseDatum(ds);if(!d||isNaN(d.getTime()))return"Ismeretlen";const n=['Vas√°rnap','H√©tf≈ë','Kedd','Szerda','Cs√ºt√∂rt√∂k','P√©ntek','Szombat'];return n[d.getDay()];}
function isHetvege(ds){const d=parseDatum(ds);if(!d||isNaN(d.getTime()))return false;return d.getDay()===0||d.getDay()===6;}

fetch('muszakok.csv').then(r=>r.text()).then(text=>{
    muszakok=[];
    text.split('\n').slice(1).forEach(line=>{
        if(!line.trim())return;
        let parts=line.split(';;').map(p=>p.trim()).filter(p=>p);
        parts.forEach(p=>{
            const col=p.split(';');
            if(col.length>=4)muszakok.push({datum:col[0],hely:col[1],muszak:col[3]});
        });
    });
    showData();
});

function showData(){
    const hVal=document.getElementById('honap').value;
    const mVal=document.getElementById('muszak').value;
    const today=new Date().toISOString().split('T')[0];
    let talalatok=muszakok;
    
    if(hVal!=='mind')talalatok=talalatok.filter(r=>r.datum.includes("-"+hVal+"-")||r.datum.includes("."+hVal+"."));
    if(mVal!=='mind')talalatok=talalatok.filter(r=>r.muszak===mVal);
    
    const napok={};
    talalatok.forEach(r=>{if(!napok[r.datum])napok[r.datum]=[];napok[r.datum].push(r);});
    
    let html='';
    Object.keys(napok).sort().forEach(datum=>{
        const dObj=parseDatum(datum);
        const isoDate=dObj?dObj.toISOString().split('T')[0]:'';
        const isToday=isoDate===today;
        const hetvege=isHetvege(datum);
        const cleanId = 'date-'+datum.replace(/[^0-9]/g, '');

        html+=`<div class="day-card ${isToday?'today-active':''}" id="${cleanId}">
            ${isToday?'<div class="today-label">MAI NAP</div>':''}
            <div class="day-card-content">
                <div class="date-header ${hetvege?'weekend':''}">
                    <span class="date-text">${datum.replace(/-/g,'. ')}${datum.endsWith('.')?'':'.'}</span>
                    <span class="day-name">${getNapNeve(datum)}</span>
                </div>`;

        napok[datum].forEach(r=>{
            const szovegLower = r.hely.trim().toLowerCase();
            const isActive = szovegLower === 'nappal' || szovegLower === '√©jszaka';
            html+=`<div class="shift-row row-muszak-${r.muszak} ${isActive?'active-shift':''}">
                <div class="shift-details">
                    <span class="loc">${r.hely}</span>
                    <span class="leader">Vezet≈ë: ${vezetok[r.muszak]||'Nincs'}</span>
                </div>
                <div class="badge">${r.muszak}</div>
            </div>`;
        });
        html+=`</div></div>`;
    });
    document.getElementById('eredmeny').innerHTML=html||'<p style="text-align:center;opacity:0.5;">Nincs tal√°lat.</p>';
}

document.getElementById('maigomb').addEventListener('click',()=>{
    const t=document.querySelector('.today-active');
    if(t)t.scrollIntoView({behavior:'smooth',block:'center'});
    else alert("A mai nap nem l√°that√≥ (ellen≈ërizd a sz≈±r≈ëket).");
});

document.getElementById('honap').addEventListener('change',showData);
document.getElementById('muszak').addEventListener('change',showData);

let calDate = new Date();
document.getElementById('calendarBtn').addEventListener('click', () => {
    document.getElementById('calModal').style.display = 'flex';
    renderCalendar();
});
function closeCalendar(e) {
    if(e === null || e.target.id === 'calModal') {
        document.getElementById('calModal').style.display = 'none';
    }
}
function changeCalMonth(delta) {
    calDate.setMonth(calDate.getMonth() + delta);
    renderCalendar();
}

function renderCalendar() {
    const year = calDate.getFullYear();
    const month = calDate.getMonth();
    const today = new Date();
    const honapok = ["Janu√°r","Febru√°r","M√°rcius","√Åprilis","M√°jus","J√∫nius","J√∫lius","Augusztus","Szeptember","Okt√≥ber","November","December"];
    document.getElementById('calTitle').innerText = `${year} ${honapok[month]}`;
    const grid = document.getElementById('calGrid');
    grid.innerHTML = '';
    const daysHeader = ['H','K','Sze','Cs','P','Szo','V'];
    daysHeader.forEach(d => grid.innerHTML += `<div class="cal-day-name">${d}</div>`);
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    let startDayIndex = firstDay.getDay() - 1; 
    if(startDayIndex === -1) startDayIndex = 6;
    for(let i=0; i<startDayIndex; i++) {
        grid.innerHTML += `<div class="cal-cell cal-empty"></div>`;
    }
    const currentFilterShift = document.getElementById('muszak').value;
    for(let i=1; i<=daysInMonth; i++) {
        const mm = String(month + 1).padStart(2, '0');
        const dd = String(i).padStart(2, '0');
        const compareDate = `${year}${mm}${dd}`;
        let shiftContent = ''; 
        const dayShifts = muszakok.filter(m => {
            const cleanCSV = m.datum.replace(/[^0-9]/g, ''); 
            return cleanCSV.startsWith(compareDate);
        });
        if (currentFilterShift === 'mind') {
            const uniqueShifts = [...new Set(dayShifts.map(m => m.muszak))].sort();
            uniqueShifts.forEach(s => { shiftContent += `<span class="code-${s}">${s}</span>`; });
        } else {
            const match = dayShifts.find(m => m.muszak === currentFilterShift);
            if(match) { shiftContent = `<span class="code-${match.muszak}">${match.muszak}</span>`; }
        }
        let isTodayClass = '';
        if(year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
            isTodayClass = 'cal-today';
        }
        const cell = document.createElement('div');
        cell.className = `cal-cell ${isTodayClass}`;
        cell.innerHTML = `<span class="cal-num">${i}</span><span class="cal-shift">${shiftContent}</span>`;
        cell.onclick = () => {
            closeCalendar(null);
            const targetId = `date-${year}${mm}${dd}`;
            const targetEl = document.getElementById(targetId);
            if(targetEl) {
                targetEl.scrollIntoView({behavior: 'smooth', block: 'center'});
                targetEl.style.transition = "transform 0.3s";
                targetEl.style.transform = "scale(1.05)";
                setTimeout(() => { targetEl.style.transform = "scale(1)"; }, 500);
            } else {
                const monthSelect = document.getElementById('honap');
                monthSelect.value = mm;
                showData();
                setTimeout(() => {
                    const newTarget = document.getElementById(targetId);
                    if(newTarget) newTarget.scrollIntoView({behavior: 'smooth', block: 'center'});
                }, 100);
            }
        };
        grid.appendChild(cell);
    }
}
</script>
</body>
</html>
